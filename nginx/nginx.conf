# nginx/nginx.conf
# Define the upstream servers for each Flask application
upstream flask_app_1 {
    # 'app1' is the service name in docker-compose.yml
    server app1:8000;
}

upstream flask_app_2 {
    # 'app2' is the service name in docker-compose.yml
    server app2:8000;
}

server {
    listen 80;
    server_name localhost; # Listen for requests to localhost

    # Route for App 1
    # Requests to http://localhost/app1/ will go to flask_app_1
    location /app1/ {
        proxy_pass http://flask_app_1/; # IMPORTANT: The trailing slash here is crucial
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Route for App 2
    # Requests to http://localhost/app2/ will go to flask_app_2
    location /app2/ {
        proxy_pass http://flask_app_2/; # IMPORTANT: The trailing slash here is crucial
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Optional: A default route if no specific app path is matched
    # You might redirect to one of your apps or a static landing page
    location / {
        # Example: Redirect to app1
        rewrite ^/$ /app1/ permanent;
        # Or serve a default static page
        # root /usr/share/nginx/html;
        # index index.html;
    }
}
